(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-069f0dd7"],{"85b8":function(t,e,s){"use strict";s("afc9")},a0c0:function(t,e,s){"use strict";s.r(e);var i=s("8212"),a=s("b0af"),n=s("62ad"),o=s("132d"),r=s("adda"),c=s("0fd9"),l=function(){var t=this,e=t._self._c;return e("div",[e("div",{staticClass:"banner",style:t.cover},[e("h1",{staticClass:"banner-title"},[t._v("说说")])]),e(a["a"],{staticClass:"blog-container"},[e("div",{staticClass:"talk-wrapper"},[e("div",{staticClass:"user-info-wrapper"},[e(i["a"],{staticClass:"user-avatar",attrs:{size:"36"}},[e("img",{attrs:{src:t.talkInfo.avatar}})]),e("div",{staticClass:"user-detail-wrapper"},[e("div",{staticClass:"user-nickname"},[t._v(" "+t._s(t.talkInfo.nickname)+" "),e(o["a"],{staticClass:"user-sign",attrs:{size:"20",color:"#ffa51e"}},[t._v(" mdi-check-decagram ")])],1),e("div",{staticClass:"time"},[t._v(t._s(t._f("time")(t.talkInfo.createTime)))]),e("div",{staticClass:"talk-content",domProps:{innerHTML:t._s(t.talkInfo.content)}}),t.talkInfo.imgList?e(c["a"],{staticClass:"talk-images"},t._l(t.talkInfo.imgList,(function(s,i){return e(n["a"],{key:i,attrs:{md:4,cols:6}},[e(r["a"],{staticClass:"images-items",attrs:{src:s,"aspect-ratio":"1","max-height":"200"},on:{click:function(e){return t.previewImg(s)}}})],1)})),1):t._e(),e("div",{staticClass:"talk-operation"},[e("div",{staticClass:"talk-operation-item"},[e(o["a"],{staticClass:"like-btn",attrs:{size:"16",color:t.isLike(t.talkInfo.id)},on:{click:function(e){return e.preventDefault(),t.like(t.talkInfo)}}},[t._v(" mdi-thumb-up ")]),e("div",{staticClass:"operation-count"},[t._v(" "+t._s(null==t.talkInfo.likeCount?0:t.talkInfo.likeCount)+" ")])],1),e("div",{staticClass:"talk-operation-item"},[e(o["a"],{attrs:{size:"16",color:"#999"}},[t._v("mdi-chat")]),e("div",{staticClass:"operation-count"},[t._v(" "+t._s(null==t.commentCount?0:t.commentCount)+" ")])],1)])],1)],1)]),e("Comment",{attrs:{type:t.commentType},on:{getCommentCount:t.getCommentCount}})],1)],1)},m=[],p=s("8336"),d=function(){var t=this,e=t._self._c;return e("div",[t._m(0),e("div",{staticClass:"comment-wrapper"},[e("div",{staticStyle:{display:"flex",width:"100%"}},[e(i["a"],{attrs:{size:"36"}},[this.$store.state.avatar?e("img",{attrs:{src:this.$store.state.avatar}}):e("img",{attrs:{src:this.$store.state.blogInfo.websiteConfig.touristAvatar}})]),e("div",{staticClass:"ml-3",staticStyle:{width:"100%"}},[e("div",{staticClass:"comment-input"},[e("textarea",{directives:[{name:"model",rawName:"v-model",value:t.commentContent,expression:"commentContent"}],staticClass:"comment-textarea",attrs:{placeholder:"留下点什么吧...","auto-grow":"",dense:""},domProps:{value:t.commentContent},on:{input:function(e){e.target.composing||(t.commentContent=e.target.value)}}})]),e("div",{staticClass:"emoji-container"},[e("span",{class:t.chooseEmoji?"emoji-btn-active":"emoji-btn",on:{click:function(e){t.chooseEmoji=!t.chooseEmoji}}},[e("i",{staticClass:"iconfont iconbiaoqing"})]),e("button",{staticClass:"upload-btn v-comment-btn",staticStyle:{"margin-left":"auto"},on:{click:t.insertComment}},[t._v(" 提交 ")])]),e("emoji",{attrs:{chooseEmoji:t.chooseEmoji},on:{addEmoji:t.addEmoji}})],1)],1)]),t.count>0&&t.reFresh?e("div",[t._l(t.commentList,(function(s,a){return e("div",{key:s.id,staticClass:"comment-wrapper"},[e(i["a"],{staticClass:"comment-avatar",attrs:{size:"40"}},[e("img",{attrs:{src:s.avatar}})]),e("div",{staticClass:"comment-meta"},[e("div",{staticClass:"comment-user"},[s.webSite?e("a",{attrs:{href:s.webSite,target:"_blank"}},[t._v(" "+t._s(s.nickname)+" ")]):e("span",[t._v(t._s(s.nickname))]),1==s.userId?e(o["a"],{attrs:{size:"20",color:"#ffa51e"}},[t._v(" mdi-check-decagram ")]):t._e()],1),e("div",{staticClass:"comment-info"},[e("span",{staticStyle:{"margin-right":"10px"}},[t._v(t._s(t.count-a)+"楼")]),e("span",{staticStyle:{"margin-right":"10px"}},[t._v(t._s(t._f("date")(s.createTime)))]),e("span",{class:t.isLike(s.id)+" iconfont icondianzan",on:{click:function(e){return t.like(s)}}}),e("span",{directives:[{name:"show",rawName:"v-show",value:s.likeCount>0,expression:"item.likeCount > 0"}]},[t._v(" "+t._s(s.likeCount))]),e("span",{staticClass:"reply-btn",on:{click:function(e){return t.replyComment(a,s)}}},[t._v(" 回复 ")])]),e("p",{staticClass:"comment-content",domProps:{innerHTML:t._s(s.commentContent)}}),t._l(s.replyDTOList,(function(n){return e("div",{key:n.id,staticStyle:{display:"flex"}},[e(i["a"],{staticClass:"comment-avatar",attrs:{size:"36"}},[e("img",{attrs:{src:n.avatar}})]),e("div",{staticClass:"reply-meta"},[e("div",{staticClass:"comment-user"},[n.webSite?e("a",{attrs:{href:n.webSite,target:"_blank"}},[t._v(" "+t._s(n.nickname)+" ")]):e("span",[t._v(t._s(n.nickname))]),1==n.userId?e(o["a"],{attrs:{size:"20",color:"#ffa51e"}},[t._v(" mdi-check-decagram ")]):t._e()],1),e("div",{staticClass:"comment-info"},[e("span",{staticStyle:{"margin-right":"10px"}},[t._v(" "+t._s(t._f("date")(n.createTime))+" ")]),e("span",{class:t.isLike(n.id)+" iconfont icondianzan",on:{click:function(e){return t.like(n)}}}),e("span",{directives:[{name:"show",rawName:"v-show",value:n.likeCount>0,expression:"reply.likeCount > 0"}]},[t._v(" "+t._s(n.likeCount))]),e("span",{staticClass:"reply-btn",on:{click:function(e){return t.replyComment(a,n)}}},[t._v(" 回复 ")])]),e("p",{staticClass:"comment-content"},[n.replyUserId!=s.userId?[n.replyWebSite?e("a",{staticClass:"comment-nickname ml-1",attrs:{href:n.replyWebSite,target:"_blank"}},[t._v(" @"+t._s(n.replyNickname)+" ")]):e("span",{staticClass:"ml-1"},[t._v(" @"+t._s(n.replyNickname)+" ")]),t._v(" ， ")]:t._e(),e("span",{domProps:{innerHTML:t._s(n.commentContent)}})],2)])],1)})),e("div",{directives:[{name:"show",rawName:"v-show",value:s.replyCount>3,expression:"item.replyCount > 3"}],ref:"check",refInFor:!0,staticClass:"mb-3",staticStyle:{"font-size":"0.75rem",color:"#6d757a"}},[t._v(" 共 "),e("b",[t._v(t._s(s.replyCount))]),t._v(" 条回复， "),e("span",{staticStyle:{color:"#00a1d6",cursor:"pointer"},on:{click:function(e){return t.checkReplies(a,s)}}},[t._v(" 点击查看 ")])]),e("div",{ref:"paging",refInFor:!0,staticClass:"mb-3",staticStyle:{"font-size":"0.75rem",color:"#222",display:"none"}},[e("span",{staticStyle:{"padding-right":"10px"}},[t._v(" 共"+t._s(Math.ceil(s.replyCount/5))+"页 ")]),e("paging",{ref:"page",refInFor:!0,attrs:{totalPage:Math.ceil(s.replyCount/5),index:a,commentId:s.id},on:{changeReplyCurrent:t.changeReplyCurrent}})],1),e("Reply",{ref:"reply",refInFor:!0,attrs:{type:t.type},on:{reloadReply:t.reloadReply}})],2)],1)})),e("div",{staticClass:"load-wrapper"},[t.count>t.commentList.length?e(p["a"],{attrs:{outlined:""},on:{click:t.listComments}},[t._v(" 加载更多... ")]):t._e()],1)],2):e("div",{staticStyle:{padding:"1.25rem","text-align":"center"}},[t._v(" 来发评论吧~ ")])])},u=[function(){var t=this,e=t._self._c;return e("div",{staticClass:"comment-title"},[e("i",{staticClass:"iconfont iconpinglunzu"}),t._v("评论")])}],h=s("2f3e"),f=s("bbe0"),v=s("bbe3"),C=s("f568"),k={components:{Reply:h["a"],Emoji:v["a"],Paging:f["a"]},props:{type:{type:Number}},created(){this.listComments()},data:function(){return{reFresh:!0,commentContent:"",chooseEmoji:!1,current:1,commentList:[],count:0}},methods:{replyComment(t,e){this.$refs.reply.forEach(t=>{t.$el.style.display="none"}),this.$refs.reply[t].commentContent="",this.$refs.reply[t].nickname=e.nickname,this.$refs.reply[t].replyUserId=e.userId,this.$refs.reply[t].parentId=this.commentList[t].id,this.$refs.reply[t].chooseEmoji=!1,this.$refs.reply[t].index=t,this.$refs.reply[t].$el.style.display="block"},addEmoji(t){this.commentContent+=t},checkReplies(t,e){this.axios.get("/api/comments/"+e.id+"/replies",{params:{current:1,size:5}}).then(({data:s})=>{this.$refs.check[t].style.display="none",e.replyDTOList=s.data,Math.ceil(e.replyCount/5)>1&&(this.$refs.paging[t].style.display="flex")})},changeReplyCurrent(t,e,s){this.axios.get("/api/comments/"+s+"/replies",{params:{current:t,size:5}}).then(({data:t})=>{this.commentList[e].replyDTOList=t.data})},listComments(){const t=this.$route.path,e=t.split("/");var s={current:this.current,type:this.type};switch(this.type){case 1:case 3:s.topicId=e[2];break;default:break}this.axios.get("/api/comments",{params:s}).then(({data:t})=>{1==this.current?this.commentList=t.data.recordList:this.commentList.push(...t.data.recordList),this.current++,this.count=t.data.count,this.$emit("getCommentCount",this.count)})},insertComment(){if(!this.$store.state.userId)return this.$store.state.loginFlag=!0,!1;if(""==this.commentContent.trim())return this.$toast({type:"error",message:"评论不能为空"}),!1;var t=/\[.+?\]/g;this.commentContent=this.commentContent.replace(t,(function(t){return"<img src= '"+C["a"][t]+"' width='22'height='20' style='padding: 0 1px'/>"}));const e=this.$route.path,s=e.split("/");var i={commentContent:this.commentContent,type:this.type};switch(this.type){case 1:case 3:i.topicId=s[2];break;default:break}this.commentContent="",this.axios.post("/api/comments",i).then(({data:t})=>{if(t.flag){this.current=1,this.listComments();const t=this.$store.state.blogInfo.websiteConfig.isCommentReview;t?this.$toast({type:"warnning",message:"评论成功，正在审核中"}):this.$toast({type:"success",message:"评论成功"})}else this.$toast({type:"error",message:t.message})})},like(t){if(!this.$store.state.userId)return this.$store.state.loginFlag=!0,!1;this.axios.post("/api/comments/"+t.id+"/like").then(({data:e})=>{e.flag&&(-1!=this.$store.state.commentLikeSet.indexOf(t.id)?this.$set(t,"likeCount",t.likeCount-1):this.$set(t,"likeCount",t.likeCount+1),this.$store.commit("commentLike",t.id))})},reloadReply(t){this.axios.get("/api/comments/"+this.commentList[t].id+"/replies",{params:{current:this.$refs.page[t].current}}).then(({data:e})=>{this.commentList[t].replyCount++,this.commentList[t].replyCount>5&&(this.$refs.paging[t].style.display="flex"),this.$refs.check[t].style.display="none",this.$refs.reply[t].$el.style.display="none",this.commentList[t].replyDTOList=e.data})}},computed:{isLike(){return function(t){var e=this.$store.state.commentLikeSet;return-1!=e.indexOf(t)?"like-active":"like"}}},watch:{commentList(){this.reFresh=!1,this.$nextTick(()=>{this.reFresh=!0})}}},g=k,y=(s("bc3c"),s("2877")),_=Object(y["a"])(g,d,u,!1,null,"7caf5f9f",null),b=_.exports,$={components:{Comment:b},created(){this.getTalkById()},data:function(){return{commentType:3,commentCount:0,talkInfo:{},previewList:[]}},methods:{getTalkById(){this.axios.get("/api/talks/"+this.$route.params.talkId).then(({data:t})=>{this.talkInfo=t.data,this.previewList=this.talkInfo.imgList})},getCommentCount(t){this.commentCount=t},previewImg(t){this.$imagePreview({images:this.previewList,index:this.previewList.indexOf(t)})},like(t){if(!this.$store.state.userId)return this.$store.state.loginFlag=!0,!1;this.axios.post("/api/talks/"+t.id+"/like").then(({data:e})=>{e.flag&&(-1!=this.$store.state.talkLikeSet.indexOf(t.id)?this.$set(t,"likeCount",t.likeCount-1):this.$set(t,"likeCount",t.likeCount+1),this.$store.commit("talkLike",t.id))})}},computed:{cover(){var t="";return this.$store.state.blogInfo.pageList.forEach(e=>{"talk"==e.pageLabel&&(t=e.pageCover)}),"background: url("+t+") center center / cover no-repeat"},isLike(){return function(t){var e=this.$store.state.talkLikeSet;return-1!=e.indexOf(t)?"#eb5055":"#999"}}}},w=$,L=(s("85b8"),Object(y["a"])(w,l,m,!1,null,"0e2f20d2",null));e["default"]=L.exports},afc9:function(t,e,s){},bc3c:function(t,e,s){"use strict";s("e915")},e915:function(t,e,s){}}]);